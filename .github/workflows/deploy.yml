name: Auto Deploy on Source B

on:
  push:
    branches:
      - main  # K√≠ch ho·∫°t khi c√≥ code push v√†o main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: C√†i ƒë·∫∑t sshpass
        run: sudo apt-get install -y sshpass

      #- name: Debug Network
       # run: |
        #  echo "üîç Ki·ªÉm tra k·∫øt n·ªëi ƒë·∫øn SSH server..."
         # nc -zv ${{ secrets.HOST }} ${{ secrets.PORT }} || echo "‚ùå Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server"

      - name: K·∫øt n·ªëi SSH b·∫±ng m·∫≠t kh·∫©u v√† tri·ªÉn khai code
        run: |
          sshpass -p "${{ secrets.PASSWORD }}" ssh -o StrictHostKeyChecking=no \
          -p ${{ secrets.PORT }} \
          ${{ secrets.USER }}@${{ secrets.HOST }} << 'EOF'
          
          echo "‚úÖ ƒê√£ SSH v√†o server!"
          cd /home/doanvanquoc/CRM-2025
          sudo systemctl stop http_server
          sudo systemctl stop socket_server
          sudo systemctl stop kafka_server
          git pull origin main
          sudo systemctl start http_server
          sudo systemctl start socket_server
          sudo systemctl start kafka_server
          
